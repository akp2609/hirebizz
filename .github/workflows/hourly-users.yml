name: Hourly Active Users Trigger

on:
    schedule:
        - cron: '0 * * * *'
    workflow_dispatch: 

jobs:
    run-hourly-script:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '18'

            - name: Install dependencies
              run: npm install
              working-directory: server

            - name: Run Azure Auth workflow
              run: node workflows/azureAuthWorkflow.js
              working-directory: server
              env:
                AZURE_WORKER_CLIENT_ID: ${{ secrets.AZURE_WORKER_CLIENT_ID }}
                AZURE_WORKER_SECRET: ${{ secrets.AZURE_WORKER_SECRET }}
                AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
                SCOPE: ${{ secrets.SCOPE }}

            - name: Debug environment
              run: |
                echo "AZURE_API_CLIENT_ID is set: ${{ vars.AZURE_WORKER_CLIENT_ID != '' }}"
                echo "Workflow executed successfully"